<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Generator</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <h1>DALLÂ·E 3 Image Generator</h1>
        <div class="input-container">
            <input type="text" id="prompt" placeholder="Enter a description">
            <button onclick="generateImage()">Generate</button>
            <button class="record-button" onclick="startRecording()">ğŸ¤ é–‹å§‹éŒ„éŸ³</button>
        </div>
        <div id="result"></div>
    </div>

    <script>
        async function generateImage() {
            const prompt = document.getElementById('prompt').value.trim();
            if (!prompt) {
                alert("Please enter a description!");
                return;
            }

            document.getElementById('result').textContent = "Generating image...";

            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt })
                });

                const result = await response.json();
                if (result.url) {
                    // Display the generated image and download button
                    document.getElementById('result').innerHTML = `
                        <img src="${result.url}" alt="Generated Image">
                        <button onclick="downloadImage('${result.url}', 'generated_image.jpg')" class="download-button">Download</button>
                    `;
                } else {
                    document.getElementById('result').textContent = result.error || "Error generating image.";
                }
            } catch (error) {
                document.getElementById('result').textContent = "Network error or server issue.";
            }
        }

        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function startRecording() {
            try {
                const response = await fetch('/start-recording', {
                    method: 'POST'
                });
                const result = await response.json();
                if (result.success) {
                    alert("é–‹å§‹éŒ„éŸ³ï¼Œç•¶æ‚¨åœæ­¢èªªè©±æ™‚æœƒè‡ªå‹•çµæŸéŒ„éŸ³ã€‚");
        
                    // ç­‰å¾…éŒ„éŸ³å®Œæˆå¾Œç²å–è½‰éŒ„çµæœ
                    setTimeout(async () => {
                        const transcriptionResponse = await fetch('/transcription');
                        const transcriptionResult = await transcriptionResponse.json();
                        if (transcriptionResult.text) {
                            // è¦†è“‹è¼¸å…¥æ¡†çš„å…§å®¹
                            document.getElementById('prompt').value = transcriptionResult.text;
                        } else {
                            alert(transcriptionResult.error || "è½‰éŒ„å¤±æ•—ã€‚");
                        }
                    }, 5000); // å»¶é²ç­‰å¾…éŒ„éŸ³å®Œæˆ
                } else {
                    alert(result.error || "éŒ„éŸ³å¤±æ•—ã€‚");
                }
            } catch (error) {
                console.error("éŒ„éŸ³æ™‚å‡ºéŒ¯ï¼š", error);
                alert("éŒ„éŸ³æ™‚å‡ºéŒ¯ã€‚");
            }
        }
        
        
    </script>
</body>
</html>
