<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tools - Image Generator and Translator</title>
    <link rel="stylesheet" href="/static/main.css">
</head>
<div class="container">
    <!-- å·¦ä¾§ï¼šç¿»è¯‘åŠŸèƒ½ -->
    <div class="panel left-panel">
        <h2>Text Translator</h2>
        <div class="input-container">
            <textarea id="text-to-translate" placeholder="Enter text to translate"></textarea>
            <button id="translate-button" onclick="translateText()">Translate</button>
        </div>
    </div>

    <!-- å³ä¾§ï¼šå›¾ç‰‡ç”ŸæˆåŠŸèƒ½ -->
    <div class="panel right-panel">
        <h2>DALLÂ·E 3 Image Generator</h2>
        <div class="input-container">
            <button class="record-button" onclick="startRecording()">ğŸ¤ Start Recording</button>
            <textarea id="prompt" placeholder="Enter a description" "></textarea>
            <button id="generate-button" onclick="generateImage()" style="display: none;">Generate</button>            
        </div>
        <div id="result" class="image-result">
            <img src="" alt="Generated Image" style="display: none;">
            <button id="download-button" style="display: none;">Download</button>
        </div>
    </div>
</div>

    

    <script>
        // Image Generator Functions
        async function generateImage() {
            const prompt = document.getElementById('prompt').value.trim();
            const resultContainer = document.getElementById('result');
            resultContainer.textContent = "Generating image...";
    
            if (!prompt) {
                resultContainer.textContent = "Please enter a description!";
                return;
            }
    
            try {
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt }),
                });
    
                const result = await response.json();
                if (result.url) {
                    resultContainer.innerHTML = `
                        <img src="${result.url}" alt="Generated Image">
                        <button onclick="downloadImage('${result.url}', 'generated_image.jpg')">Download</button>
                    `;
                } else {
                    resultContainer.textContent = result.error || "Error generating image.";
                }
            } catch (error) {
                console.error("Error generating image:", error);
                resultContainer.textContent = "Network error or server issue.";
            }
        }
        
        function downloadImage(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        

        async function startRecording() {
            try {
                const response = await fetch('/start-recording', { method: 'POST' });
                const result = await response.json();
                if (result.success) {
                    alert("é–‹å§‹éŒ„éŸ³...");
    
                    // ç­‰å¾…éŒ„éŸ³å®Œæˆå¾Œæª¢æŸ¥è¼¸å…¥æ¡†å…§å®¹
                    setTimeout(async () => {
                        const transcriptionResponse = await fetch('/transcription');
                        const transcriptionResult = await transcriptionResponse.json();
                        if (transcriptionResult.text) {
                            document.getElementById('prompt').value = transcriptionResult.text;
                            alert("è½‰éŒ„æˆåŠŸï¼");
    
                            // é¡¯ç¤ºç”ŸæˆæŒ‰éˆ•
                            document.getElementById('generate-button').style.display = 'block';
                        } else {
                            alert(transcriptionResult.error || "è½‰éŒ„å¤±æ•—ã€‚");
                        }
                    }, 5000); // é©ç•¶å»¶é²ç­‰å¾…éŒ„éŸ³å®Œæˆ
                } else {
                    alert(result.error || "éŒ„éŸ³å¤±æ•—ã€‚");
                }
            } catch (error) {
                console.error("éŒ„éŸ³éç¨‹å‡ºéŒ¯ï¼š", error);
            }
        }
    
        
        
        // è¼ªè©¢å¾Œç«¯ç²å–è½‰éŒ„æ–‡æœ¬
        async function pollTranscription() {
            const maxRetries = 10;
            const interval = 2000;
            let retryCount = 0;
        
            const resultContainer = document.getElementById('prompt'); // å°æ‡‰çš„è¼¸å…¥æ¡†
            const generateButton = document.getElementById('generate-button'); 
        
            while (retryCount < maxRetries) {
                try {
                    const transcriptionResponse = await fetch('/transcription', { method: 'GET' });
                    const transcriptionResult = await transcriptionResponse.json();
        
                    if (transcriptionResult.text) {
                        // æˆåŠŸç²å–æ–‡å­—ï¼Œæ›´æ–°è¼¸å…¥æ¡†ä¸¦é¡¯ç¤ºç”ŸæˆæŒ‰éˆ•
                        resultContainer.value = transcriptionResult.text;
                        generateButton.style.display = 'block';
                        return; // çµæŸè¼ªè©¢
                    }
        
                    retryCount++;
                    await new Promise((resolve) => setTimeout(resolve, interval));
                } catch (error) {
                    console.error("ç²å–è½‰éŒ„æ–‡æœ¬æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
                    break; // ç™¼ç”ŸéŒ¯èª¤æ™‚é€€å‡ºè¼ªè©¢
                }
            }
        
            console.log("è¼ªè©¢å¤±æ•—ï¼Œæœªèƒ½ç²å–è½‰éŒ„æ–‡æœ¬ã€‚");
        }
        
        async function translateText() {
            const textArea = document.getElementById('text-to-translate');
            const text = textArea.value.trim();
            const targetLanguage = "English";
        
            if (!text) {
                alert('è«‹è¼¸å…¥è¦ç¿»è­¯çš„æ–‡å­—ï¼');
                return;
            }
        
            try {
                const response = await fetch('/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, target_language: targetLanguage }) // ç¢ºä¿æ•¸æ“šæ ¼å¼æ­£ç¢º
                });
        
                const result = await response.json();
        
                if (response.ok) {
                    textArea.value = result.translated_text || 'ç¿»è­¯å¤±æ•—';
                } else {
                    console.error('ç¿»è­¯å¤±æ•—:', result.error);
                    alert(result.error || 'ç¿»è­¯å¤±æ•—');
                }
            } catch (error) {
                console.error('è«‹æ±‚éŒ¯èª¤:', error);
                alert('ç¿»è­¯éç¨‹ä¸­å‡ºç¾éŒ¯èª¤');
            }
        }
        
        

        
    </script>
</body>
</html>
